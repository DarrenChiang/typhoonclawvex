
#include <math.h>
#include <MIDI.h>

const int potIn1 = A0;
const int potIn2 = A1;
const int potIn3 = A2;
const int potIn4 = A3;

int RawValue1 = 0;
int RawValue2 = 0;
int RawValue3 = 0;
int RawValue4 = 0;

int _note, _key, _range, _volume;

int stepArr[] = {0,2,4,5,7,9,11,12};

void noteOn(byte channel, byte pitch, byte velocity) {
  MIDIEvent noteOn = {0x09, 0x90 | channel, pitch, velocity};
  MIDIUSB.write(noteOn);
}

void noteOff(byte channel, byte pitch, byte velocity) {
  MIDIEvent noteOff = {0x08, 0x80 | channel, pitch, velocity};
  MIDIUSB.write(noteOff);
}

void playNote(int note, int t){
 noteOn(0, note, 64);
 MIDIUSB.flush();
 delay(t);
  
 noteOff(0, note, 64);
 MIDIUSB.flush();
}

void setup() {
  // put your setup code here, to run once:
  pinMode(potIn1, INPUT);
  pinMode(potIn2, INPUT);
  pinMode(potIn3, INPUT);
  //pinMode(potIn4, INPUT);
  Serial.begin(9600);
}

void loop() {
  // put your main code here, to run repeatedly: 
  RawValue1 = analogRead(potIn1);
  RawValue2 = analogRead(potIn2);
  RawValue3 = analogRead(potIn3);
  
  _key = (int)((double)RawValue1/1023*11);
  _range = (int)((double)RawValue3/1023*2+4);
  _note = _key+stepArr[(int)((double)RawValue2/1023*7)]+_range*12;
  
  playNote(_note, 500);
  Serial.println(1);
  
  delay(500);
}
